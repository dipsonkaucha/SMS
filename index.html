<!-- index.html -->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Attendance | School Management</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
  <style>
    body { font-family: 'Poppins', sans-serif; }
  </style>
</head>
<body class="bg-gradient-to-tr from-green-100 via-blue-100 to-purple-200 min-h-screen p-6">
  <div class="max-w-5xl mx-auto bg-white p-8 rounded-3xl shadow-lg">
    <h1 class="text-3xl font-bold text-center text-indigo-700 mb-6"> Mark Attendance</h1>
    <form id="attendanceForm">
      <div id="studentList" class="space-y-3 mb-6"></div>
      <button type="submit" class="w-full bg-gradient-to-r from-green-400 to-emerald-500 text-white font-bold py-3 rounded-xl mt-4 transform hover:scale-105 transition-transform duration-300 shadow-lg hover:shadow-2xl">
         Submit Attendance
      </button>
    </form>
    <div class="text-center mt-6 flex flex-col gap-4 sm:flex-row sm:justify-center">
      <a href="students.html" class="inline-block bg-indigo-500 text-white px-6 py-2 rounded-xl shadow-md hover:scale-105 transition">
         Manage Students
      </a>
      <button onclick="logout()" class="inline-block bg-red-500 text-white px-6 py-2 rounded-xl shadow-md hover:scale-105 transition">
         Logout
      </button>
      <button onclick="showMonthlyReport()" class="inline-block bg-yellow-500 text-white px-6 py-2 rounded-xl shadow-md hover:scale-105 transition">
         Monthly Report
      </button>
    </div>
    <div id="monthlyReport" class="mt-8 hidden">
      <h2 class="text-2xl font-semibold text-indigo-600 mb-4"> Monthly Attendance</h2>
      <div id="reportContent" class="overflow-auto"></div>
    </div>
  </div>
  <script>
    function logout() {
      localStorage.removeItem("isLoggedIn");
      window.location.href = "login.html";
    }
    if (!localStorage.getItem("isLoggedIn")) {
      window.location.href = "login.html";
    }

    const studentContainer = document.getElementById("studentList");
    const storedStudents = JSON.parse(localStorage.getItem("students")) || [];

    function renderAttendanceInputs() {
      studentContainer.innerHTML = "";
      if (storedStudents.length === 0) {
        studentContainer.innerHTML = `<p class='text-center text-gray-500'>No students found. Please add students first.</p>`;
        return;
      }
      const sorted = [...storedStudents].sort((a, b) => a.localeCompare(b));
      sorted.forEach((student, index) => {
        const wrapper = document.createElement("div");
        wrapper.className = "flex items-center justify-between bg-indigo-50 px-4 py-3 rounded-lg shadow-sm";
        wrapper.innerHTML = `
          <span>${index + 1}. ${student}</span>
          <label class="flex items-center gap-2">
            <input type="radio" name="${student}" value="Present" required>
            <span>Present</span>
            <input type="radio" name="${student}" value="Absent">
            <span>Absent</span>
          </label>
        `;
        studentContainer.appendChild(wrapper);
      });
    }

    renderAttendanceInputs();

    document.getElementById("attendanceForm").addEventListener("submit", function (e) {
      e.preventDefault();
      const formData = new FormData(e.target);
      const today = new Date();
      const todayKey = today.toISOString().split("T")[0];
      const attendanceData = JSON.parse(localStorage.getItem("attendance") || "{}");
      const dailyRecord = {};

      storedStudents.forEach((student) => {
        dailyRecord[student] = formData.get(student) || "Absent";
      });

      attendanceData[todayKey] = dailyRecord;
      localStorage.setItem("attendance", JSON.stringify(attendanceData));
      alert("Attendance submitted successfully!");
      e.target.reset();
      showMonthlyReport();
      setTimeout(() => document.getElementById('monthlyReport').scrollIntoView({ behavior: 'smooth' }), 300);
    });

    function showMonthlyReport() {
      const container = document.getElementById("monthlyReport");
      const content = document.getElementById("reportContent");
      const attendanceData = JSON.parse(localStorage.getItem("attendance") || "{}");
      const sortedStudents = [...storedStudents].sort((a, b) => a.localeCompare(b));
      const today = new Date();
      const year = today.getFullYear();
      const month = today.getMonth();
      const daysInMonth = new Date(year, month + 1, 0).getDate();

      let table = `<table class="min-w-full border text-center text-sm">
        <thead><tr><th class="border px-2 py-1">Roll No.</th><th class="border px-2 py-1">Name</th>`;
      for (let d = 1; d <= daysInMonth; d++) {
        table += `<th class="border px-2 py-1">${d}</th>`;
      }
      table += `</tr></thead><tbody>`;

      sortedStudents.forEach((name, index) => {
        table += `<tr><td class="border px-2 py-1">${index + 1}</td><td class="border px-2 py-1">${name}</td>`;
        for (let d = 1; d <= daysInMonth; d++) {
          const dateStr = `${year}-${String(month + 1).padStart(2, '0')}-${String(d).padStart(2, '0')}`;
          const status = attendanceData[dateStr]?.[name];
          let display = "-";
          let bg = "text-gray-500";

          if (status === "Present") {
            display = "P";
            bg = "bg-green-100 text-green-700";
          } else if (status === "Absent") {
            display = "A";
            bg = "bg-red-100 text-red-700";
          }

          table += `<td class="border px-2 py-1 ${bg}">${display}</td>`;
        }
        table += `</tr>`;
      });

      table += `</tbody></table>`;
      content.innerHTML = table;
      container.classList.remove("hidden");
    }
  </script>
</body>
</html>
